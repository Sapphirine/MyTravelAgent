<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Advanced Big Data Analytics Final Project</title>
    <style>

body  {
    background-image: url("img/bg1.jpg");
    background-repeat: no-repeat;
    background-attachment: fixed;
    margin: 0;
}

h1.title {
    font-size: 80px;
    max-height: 65px;
    color: white;
    text-align:center;
    font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
}

h1.subtitle {
    font-size: 20px;
    color: white;
    text-align:center;
    font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
}

div.search {
    text-align: center;
    margin: 50px;
    margin-top: 110px;
}

.splash-container {
    z-index: 1;
    overflow: hidden;
    width: 100%;
    height: 88%;
    top: 0;
    left: 0;
    position: fixed !important;
}

.content-wrapper {
    position: absolute;
    top: 87%;
    width: 100%;
    min-height: 12%;
    z-index: 2;
    background: white;
}


input {
  outline: none;
}
input[type=search] {
  -webkit-appearance: textfield;
  -webkit-box-sizing: content-box;
  font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
  font-size: 90%;
}
input::-webkit-search-decoration,
input::-webkit-search-cancel-button {
  display: none; 
}


input[type=search] {
  width: 190px;
  border: solid 2px #ccc;
  padding: 15px 10px 15px 35px;
  opacity: 0.9;
  
  -webkit-border-radius: 10em;
  -moz-border-radius: 10em;
  border-radius: 13px;
  
  -webkit-transition: all .5s;
  -moz-transition: all .5s;
  transition: all .5s;
}

input[type=search]:focus {

  width: 400px;
  background-color: #fff;
  border-color: #66CC75;
  
  -webkit-box-shadow: 0 0 5px rgba(109,207,246,.5);
  -moz-box-shadow: 0 0 5px rgba(109,207,246,.5);
  box-shadow: 0 0 5px rgba(109,207,246,.5);
}


input:-moz-placeholder {
  color: #999;
}
input::-webkit-input-placeholder {
  color: #999;
}



#map-canvas {
  border: solid 2px #ccc;
  width: auto;
  height: 650px;
}

    </style>

<script src="https://maps.googleapis.com/maps/api/js"></script>
<script>

  var map;

  function initialize() {
    var mapCanvas = document.getElementById('map-canvas');
    var mapOptions = {
      center: new google.maps.LatLng(40.8069062, -73.9653714),
      zoom: 15,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
//      zoomControl: false,
//      scaleControl: false,
      scrollwheel: false,
    }
    map = new google.maps.Map(mapCanvas, mapOptions)
  }
  google.maps.event.addDomListener(window, 'load', initialize);


  function basicSearch() {
    var inputString = document.getElementById("userInput").value;
    document.getElementById('userInput').value = '';
    websocket = new WebSocket(wsUri);
    websocket.onopen = function() {
      websocket.send(inputString);
    };
    websocket.onmessage = function(evt) {
      var message = evt.data;
//      window.alert(message);

      document.body.style.backgroundImage = "url('img/bg2.jpg')";


      var messageParse = evt.data.split("\t");
      var latitude = parseFloat(messageParse[0]);
      var longitude = parseFloat(messageParse[1]);
      var latlng = new google.maps.LatLng(parseFloat(messageParse[0]), parseFloat(messageParse[1]));

      var infowindow = new google.maps.InfoWindow({
        content: '<img src=' + messageParse[2] + '>'
      });
      
      var marker = new google.maps.Marker({
//        position: new google.maps.LatLng(40.8069062, -73.9653714),
        map: map,
        position: latlng,
        title:"Result point"
      });

      infowindow.open(map,marker);

      map.setZoom(15);
      map.setCenter(latlng);

//      marker.setMap(map);
//      google.maps.event.trigger(map, 'resize');

//      window.alert(document.getElementById("userInput").style.width);
      document.getElementById("userInput").style.width="400px";
      document.getElementById("userInput").placeholder="Say something here and we will find you a place to go";
//      document.getElementById("inputBox").style.display="none";

      websocket.close();

    };
    websocket.onerror = function(evt) {
    };
    websocket.onclose = function(evt) {
    };



  }
</script>

<script>
  var wsUri = "ws://192.168.1.145:8000/"
</script>

  </head>

  <body>
    <div class="splash-container">
      <h1 class="title">MyTravelAgent</h1>
      <h1 class="subtitle">Some words very zhuangbi here.</h1>
      <div class="search" id="inputBox">
        <form onsubmit="basicSearch(); return false;">
          <input type="search" id="userInput" placeholder="Which city are you going?">
<!--           <input type="search" id="userInput" placeholder="Say something here and we will find you a place to go"> -->
        </form>
      </div>
    </div>
    <div class="content-wrapper">
      <div id="map-canvas"></div>
    </div>
  </body>
</html>