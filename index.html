<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Advanced Big Data Analytics Final Project</title>
    <style>

body  {
    background-image: url("img/bg1.jpg");
    background-repeat: no-repeat;
    margin: 0;
}

h1.title {
    font-size: 80px;
    max-height: 65px;
    color: white;
    text-align:center;
    font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
}

h1.subtitle {
    font-size: 20px;
    color: white;
    text-align:center;
    font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
}

div.search {
    text-align: center;
    margin: 50px;
}


input {
  outline: none;
}
input[type=search] {
  -webkit-appearance: textfield;
  -webkit-box-sizing: content-box;
  font-family: inherit;
  font-size: 100%;
}
input::-webkit-search-decoration,
input::-webkit-search-cancel-button {
  display: none; 
}


input[type=search] {

  border: solid 2px #ccc;
  padding: 15px 10px 15px 35px;
  width: 400px;
  opacity: 0.9;
  
  -webkit-border-radius: 10em;
  -moz-border-radius: 10em;
  border-radius: 10em;
  
  -webkit-transition: all .5s;
  -moz-transition: all .5s;
  transition: all .5s;
}
input[type=search]:focus {
  width: 800px;
  background-color: #fff;
  border-color: #66CC75;
  
  -webkit-box-shadow: 0 0 5px rgba(109,207,246,.5);
  -moz-box-shadow: 0 0 5px rgba(109,207,246,.5);
  box-shadow: 0 0 5px rgba(109,207,246,.5);
}


input:-moz-placeholder {
  font-size: 90%;
  color: #999;
  font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
}
input::-webkit-input-placeholder {
  font-size: 90%;
  color: #999;
  font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
}



#map-canvas {
  border: solid 2px #ccc;
  width: auto;
  height: 400px;
}

    </style>

<script src="https://maps.googleapis.com/maps/api/js"></script>
<script>

  var map;

  function initialize() {
    var mapCanvas = document.getElementById('map-canvas');
    var mapOptions = {
      center: new google.maps.LatLng(40.8069062, -73.9653714),
      zoom: 15,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    map = new google.maps.Map(mapCanvas, mapOptions)
  }
  google.maps.event.addDomListener(window, 'load', initialize);


  function basicSearch() {
    var inputString = document.getElementById("userInput").value;
    document.getElementById('userInput').value = '';
    websocket = new WebSocket(wsUri);
    websocket.onopen = function() {
      websocket.send(inputString);
    };
    websocket.onmessage = function(evt) {
      var message = evt.data;
//      window.alert(message);


      var messageParse = evt.data.split(" ", 2);
      var latitude = parseFloat(messageParse[0]);
      var longitude = parseFloat(messageParse[1]);
      var latlng = new google.maps.LatLng(parseFloat(messageParse[0]), parseFloat(messageParse[1]));
      
      var marker = new google.maps.Marker({
//        position: new google.maps.LatLng(40.8069062, -73.9653714),
        position: latlng,
        title:"Result point"
      });

      map.setZoom(15);
      map.setCenter(latlng);

      marker.setMap(map);
      google.maps.event.trigger(map, 'resize');

      websocket.close();

    };
    websocket.onerror = function(evt) {
    };
    websocket.onclose = function(evt) {
    };



  }
</script>

<script>
  var wsUri = "ws://192.168.1.145:8000/"
</script>

  </head>

    <body>

      <h1 class="title">MyTravelAgent</h1>
      <h1 class="subtitle">Some words very zhuangbi here.</h1>
      <div class="search">
        <form onsubmit="basicSearch(); return false;">
          <input type="search" id="userInput" placeholder="Say something here and we will find you a place to go">
        </form>
      </div>
      <div id="map-canvas"></div>

    </body>
  </html>